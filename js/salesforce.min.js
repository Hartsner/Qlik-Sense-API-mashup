var config={host:window.location.hostname,prefix:"/",port:window.location.port,isSecure:window.location.protocol==="https:"};require.config({baseUrl:(config.isSecure?"https://":"http://")+config.host+(config.port?":"+config.port:"")+config.prefix+"resources"});require(["js/qlik"],function(qlik){qlik.setOnError(function(error){alert(error.message);});var app=qlik.openApp('932a38cf-e002-4c9a-b435-bbeed4295013',config);var c="state_abbr";app.createList({"qDef":{'qFieldDefs':[c]},'qInitialDataFetch':[{qTop:0,qLeft:0,qHeight:52,qWidth:1}]},function(reply){var data=[];var getqText=[];var qObject=reply.qListObject;$.each(qObject.qDataPages[0].qMatrix,function(){var item=this[0];getqText.push(this[0].qText);});filterInt=function(value){if(/^(\-|\+)?([0-9]+|Infinity)$/.test(value))
return Number(value);return NaN;}
getqText=filterInt(getqText);$(function(){$('#world').highcharts('Map',{chart:{borderWidth:1},title:{text:'Maybe will work :P'},legend:{layout:'horizontal',borderWidth:0,backgroundColor:'rgba(255,255,255,0.85)',floating:true,verticalAlign:'top',y:25},mapNavigation:{enabled:true},colorAxis:{min:1,type:'logarithmic',minColor:'#EEEEFF',maxColor:'#000022',stops:[[0,'#EFEFFF'],[0.67,'#4444FF'],[1,'#000022']]},series:[{animation:{duration:1000},data:getqText,mapData:Highcharts.maps['countries/us/us-all'],joinBy:['postal-code','code'],dataLabels:{enabled:true,color:'white',format:'{point.code}'},name:'Population density',tooltip:{pointFormat:'{point.code}: {point.value}/kmÂ²'}}]});});});var itemValue;var ChangeqFieldDefs="Month";app.createList({"qDef":{'qFieldDefs':[ChangeqFieldDefs]},'qInitialDataFetch':[{qTop:0,qLeft:0,qHeight:12,qWidth:1}]},function(reply){$("#fieldList").empty();var qObject=reply.qListObject;$.each(qObject.qDataPages[0].qMatrix,function(){var getqText=[];var item=this[0];getqText.push(this[0].qText);var selT="";if(item.qState=="S"){selT=" class=\"active\"";}
$("#fieldList").append("<li"+selT+">"+item.qText+"</li>");});$("#fieldList li").click(function(){app.field(ChangeqFieldDefs).toggleSelect($(this).text(),true);});var numItems=$('#fieldList .active').length;if(numItems>0){$('#m').empty().append(numItems+" of 12 months"+" <span class='caret'><span>");}
else{$('#m').empty().append("All Months"+" <span class='caret'><span>");}});var countryValue;var CountryFieldDefs="Region Name";app.createList({"qDef":{'qFieldDefs':[CountryFieldDefs]},'qInitialDataFetch':[{qTop:0,qLeft:0,qHeight:6,qWidth:1}]},function(reply){$("#fieldListC").empty();$.each(reply.qListObject.qDataPages[0].qMatrix,function(){var country=[];var item=this[0];country.push(this[0].qText);var selT="";if(item.qState=="S"){selT=" class=\"active2\"";}
$("#fieldListC").append("<li"+selT+">"+item.qText+"</li>");});$("#fieldListC li").click(function(){app.field(CountryFieldDefs).toggleSelect($(this).text(),true);});var numItems=$('#fieldListC .active2').length;if(numItems>0){$('#c').empty().append(numItems+" of 6 Regions"+" <span class='caret'><span>");}
else{$('#c').empty().append("All Regions"+" <span class='caret'><span>");}});var salesValue;var salesRep="Sales Rep Name";app.createList({"qDef":{'qFieldDefs':[CountryFieldDefs]},'qInitialDataFetch':[{qTop:0,qLeft:0,qHeight:6,qWidth:1}]},function(reply){$("#fieldListC").empty();$.each(reply.qListObject.qDataPages[0].qMatrix,function(){var country=[];var item=this[0];country.push(this[0].qText);var selT="";if(item.qState=="S"){selT=" class=\"active2\"";}
$("#fieldListC").append("<li"+selT+">"+item.qText+"</li>");});$("#fieldListC li").click(function(){app.field(CountryFieldDefs).toggleSelect($(this).text(),true);});var numItems=$('#fieldListC .active2').length;if(numItems>0){$('#c').empty().append(numItems+" of 6 Regions"+" <span class='caret'><span>");}});app.createCube({qDimensions:[{qDef:{qFieldDefs:["Region Name"]}}],qMeasures:[{qDef:{qDef:"Sum([YTD Sales Amount])",qlabel:"Sales"}}],qInitialDataFetch:[{qHeight:6,qWidth:2}]},function(reply){var fieldArray=[];var defArray=[];$.each(reply.qHyperCube.qDataPages[0].qMatrix,function(index,value){var num=this[1].qText;num.substring(1);num=num.replace(/,/g,'.');num=num.substring(1);num=parseFloat(num);if(!this[0].qIsEmpty){var n=[];n.push(this[1].qText,num);fieldArray.push(n);defArray.push(this[0].qText);}});$(function(){$('#barChart').highcharts({colors:["#6C7A89"],chart:{type:'column'},title:{text:'Sum YTD sales'},xAxis:{categories:defArray},yAxis:{title:{text:"Sales"}},legend:{enabled:false},credits:{enabled:false},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:true,format:'${point.y:.1f}M'},point:{events:{click:function(e){var dim1=this.category;var arr=[];arr.push(dim1);app.field("Region Name").selectValues(arr,false,true);}}},column:{states:{hover:{color:'#DADFE1'}}}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}M $</b> of total<br/>'},series:[{name:"Sales",colorByPoint:true,data:fieldArray,color:"#DADFE1",}]});});});app.createCube({qDimensions:[{qDef:{qFieldDefs:["Region Name"]}}],qMeasures:[{qDef:{qDef:"Sum([YTD Sales Amount])",qlabel:"Sales",}},{qDef:{qDef:"Sum ([YTD Budget Amount])",qlabel:"Sales Goal",}}],qInitialDataFetch:[{qHeight:6,qWidth:3}]},function(reply){var fieldArray=[];var defArray=[];var budget=[];var sales=(reply.qHyperCube.qGrandTotalRow[0].qText);$("#total").text(sales);$.each(reply.qHyperCube.qDataPages[0].qMatrix,function(index,value){var num=this[1].qText;num.substring(1);num=num.replace(/,/g,'.');num=num.substring(1);num=parseFloat(num);if(!this[0].qIsEmpty){var n=[];n.push(this[1].qText,num);fieldArray.push(n);defArray.push(this[0].qText);}
var bud=this[2].qText;bud.substring(1);bud=bud.replace(/,/g,'.');bud=bud.substring(1);bud=parseFloat(bud);if(!this[0].qIsEmpty){var n=[];n.push(this[2].qText,bud);budget.push(n);}});$(function(){$('#pieChart').highcharts({chart:{zoomType:'xy'},title:{text:''},subtitle:{text:''},xAxis:[{categories:defArray,crosshair:true}],yAxis:[{title:{text:'Sales Budget',style:{color:'#494949'}},labels:{format:'${value} M',style:{color:'#494949'}}},{title:{text:'',style:{color:'#494949'}},labels:{format:'${value} M',style:{color:'#494949'}},opposite:true}],tooltip:{shared:true},credits:{enabled:false},legend:{layout:'vertical',align:'left',x:120,verticalAlign:'top',y:100,floating:true,backgroundColor:(Highcharts.theme&&Highcharts.theme.legendBackgroundColor)||'#FFFFFF'},series:[{name:'Sales',type:'column',data:fieldArray,color:"#6C7A89",tooltip:{valueSuffix:' K'},point:{events:{click:function(){var dim1=this.category;var arr=[];arr.push(dim1);app.field("Region Name").selectValues(arr,false,true);}}}},{name:'Budget',type:'spline',data:budget,color:"#1E824C",tooltip:{valueSuffix:' K'},point:{events:{click:function(){var dim1=this.category;var arr=[];arr.push(dim1);app.field("Region Name").selectValues(arr,false,true);}}},column:{states:{hover:{color:'#DADFE1'}}}}]});});});app.createCube({qDimensions:[{qDef:{qFieldDefs:["Region Name"]}}],qMeasures:[{qDef:{qDef:"Avg([List Price])",qlabel:"Avg List Price"}}],qInitialDataFetch:[{qHeight:6,qWidth:2}]},function(reply){var fieldArray=[];var defArray=[];$.each(reply.qHyperCube.qDataPages[0].qMatrix,function(index,value){var num=this[1].qText;num.substring(1);num=num.replace(/,/g,'.');num=num.substring(1);num=parseFloat(num);if(!this[0].qIsEmpty){var n=[];n.push(this[1].qText,num);fieldArray.push(n);defArray.push(this[0].qText);}});$(function(){$('#barChart1').highcharts({colors:["#6C7A89"],chart:{type:'bar'},title:{text:'Avg List Price'},xAxis:{categories:defArray},yAxis:{title:{text:"List Price"}},legend:{enabled:false},credits:{enabled:false},plotOptions:{series:{borderWidth:0,color:"#ff0000",dataLabels:{enabled:true,format:'${point.y:.1f}M'},point:{events:{click:function(){var dim1=this.category;var arr=[];arr.push(dim1);app.field("Region Name").selectValues(arr,false,true);}}},column:{states:{hover:{color:'#DADFE1'}}}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}M $</b> of total<br/>'},series:[{name:"Sales",colorByPoint:true,data:fieldArray}]});});});app.createCube({"qInitialDataFetch":[{"qHeight":20,"qWidth":7}],"qDimensions":[{"qDef":{"qFieldDefs":["Invoice Number"]},"qNullSuppression":true,"qOtherTotalSpec":{"qOtherMode":"OTHER_OFF","qSuppressOther":true,"qOtherSortMode":"OTHER_SORT_DESCENDING","qOtherCounted":{"qv":"5"},"qOtherLimitMode":"OTHER_GE_LIMIT"},},{"qDef":{"qFieldDefs":["Order Number"]},"qNullSuppression":true,"qOtherTotalSpec":{"qOtherMode":"OTHER_OFF","qSuppressOther":true,"qOtherSortMode":"OTHER_SORT_DESCENDING","qOtherCounted":{"qv":"5"},"qOtherLimitMode":"OTHER_GE_LIMIT"}},{"qDef":{"qFieldDefs":["Customer"]}},{"qDef":{"qFieldDefs":["Invoice Date"]}},{"qDef":{"qFieldDefs":["Promised Delivery Date"]}}],"qMeasures":[{"qDef":{"qDef":"sum([Sales Amount]) ",qlabel:"Sales Amount"},"qSortCriterias":[{"qSortByNumeric":1}]},{"qDef":{"qDef":"Sum ([Sales Quantity])",qlabel:"Sales Quantity"}}]},function(reply){var fieldArray=[];var defArray=[];var arr1=[];var arr2=[];var arr3=[];var arr4=[];var arr5=[];String.prototype.commafy=function(){return this.replace(/(^|[^\w.])(\d{4,})/g,function($0,$1,$2){return $1+$2.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,");});};var sales=(reply.qHyperCube.qGrandTotalRow[0].qText);sales=sales.commafy();$("#totalSales").text("$"+sales);var qty=(reply.qHyperCube.qGrandTotalRow[1].qNum);qty=Math.round(qty);qty=qty.toString();qty=qty.commafy();$("#totalQty").text(qty);$.each(reply.qHyperCube.qDataPages[0].qMatrix,function(index,value){if(!this[0].qIsEmpty){defArray.push(this[0].qText);fieldArray.push(this[1].qText);arr1.push(this[2].qText);arr2.push(this[3].qText);arr3.push(this[4].qText);arr4.push(this[5].qNum);arr5.push(this[6].qNum);}});$("#trans").empty();for(i=0;i<=defArray.length;i++){$("#trans").append('<tr><td>'+defArray[i]+'</td><td>'+fieldArray[i]+'</td><td>'+arr1[i]+'</td><td>'+arr2[i]+'</td><td>'+arr3[i]+'</td><td>'+"($"+arr4[i]+')</td><td>'+arr5[i]+'</td></tr>');}});app.createCube({qDimensions:[{qDef:{qFieldDefs:["Product Line Desc"]}}],qMeasures:[{qDef:{qDef:"sum([Sales Amount])"}}],qInitialDataFetch:[{qHeight:2,qWidth:2}]},function(reply){var arr=[];var total=(reply.qHyperCube.qGrandTotalRow[0].qNum);$.each(reply.qHyperCube.qDataPages[0].qMatrix,function(index,value){var food=this[0].qNum;var num=this[1].qNum;arr.push(num);});var food=arr[0]/ total;var drink=arr[1]/ total;food=Math.ceil((food)*100);drink=Math.floor((drink)*100);$("#food").empty().append(food+"% Food").css("width",food+"%");$("#drink").empty().append(drink+"% Drink").css("width",drink+"%");});app.createCube({"qInitialDataFetch":[{"qHeight":20,"qWidth":7}],"qDimensions":[{"qDef":{"qFieldDefs":["Product Group Desc"]}}],"qMeasures":[{"qDef":{"qDef":"Sum ({<[Product Group Desc]={*}>}[Sales Margin Amount])/Sum ({<[Product Group Desc]={*}>}[Sales Amount])",qlabel:"GPM%"},"qSortCriterias":[{"qSortByNumeric":1}]},{"qDef":{"qDef":"sum({<[Product Group Desc]={*}>} [Sales Amount])",qlabel:"Sales"}}]},function(reply){var arr1=[];var arr2=[];var arr3=[];var arrM=[];var arrPercent=[];String.prototype.commafy=function(){return this.replace(/(^|[^\w.])(\d{4,})/g,function($0,$1,$2){return $1+$2.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,");});};$.each(reply.qHyperCube.qDataPages[0].qMatrix,function(index,value){if(!this[0].qIsEmpty){arr1.push(this[0].qText);arr2.push(this[1].qNum);arr3.push(this[2].qNum);}});for(i=0;i<arr2.length;i++){arr2[i]=Math.floor((arr2[i])*100);arrPercent.push(arr2[i]);}
for(i=0;i<arr3.length;i++){arr3[i]=Math.round(arr3[i]);arr3[i]=arr3[i].toString();arr3[i]=arr3[i].commafy();arr3[i]=parseFloat(arr3[i]);arrM.push(arr3[i]);}
var jarray=[];for(i=0;i<arrPercent.length&&i<arrM.length;i++){jarray.push([arrPercent[i],arrM[i]]);}
var last=[];for(i=0;i<jarray.length;i++){last.push(jarray[i]);}
$(function(){var series=[];series=generateData(arrPercent,arr1,arrM);function generateData(percent,names,sales){var ret={},ps=[],series=[],len=percent.length;for(var i=0;i<len;i++){ps[i]={x:percent[i],y:sales[i],n:names[i]};}
names=[];for(i=0;i<len;i++){var p=ps[i],sIndex=$.inArray(p.n,names);if(sIndex<0){sIndex=names.push(p.n)-1;series.push({name:p.n,data:[]});}
series[sIndex].data.push(p);}
return series;}
$('#bubbleChart').highcharts({chart:{type:'bubble',zoomType:'xy'},credits:{enabled:false},xAxis:{title:{enabled:true,text:'GPM%'},startOnTick:true,endOnTick:true,showLastLabel:true},yAxis:{title:{text:'Sales ($)'}},title:{text:'Total Sales vs. Gross Profit Margin %'},tooltip:{headerFormat:'<b>{series.name}</b><br>',pointFormat:' Sales: ${point.y}M , GPM%: {point.x} %'},series:series});});});app.createCube({"qInitialDataFetch":[{"qHeight":56,"qWidth":7}],"qDimensions":[{"qDef":{"qFieldDefs":["state_abbr"]}}],"qMeasures":[{"qDef":{"qDef":"count(Distinct Customer)",qlabel:"Count Costumer"}}]},function(reply){var arr1=[];var arr2=[];$.each(reply.qHyperCube.qDataPages[0].qMatrix,function(index,value){if(!this[0].qIsEmpty){arr1.push(this[0].qText);arr2.push(this[1].qNum);}});console.log("states",arr1);var sample=[];for(var i=0;i<arr1.length&&arr2.length;i++)
sample.push({"code":arr1[i],"value":arr2[i]});console.log(sample);$(function(){$('#worldChart').highcharts('Map',{chart:{borderWidth:0},title:{text:'Customers'},legend:{layout:'horizontal',borderWidth:0,backgroundColor:'rgba(38,166,91,0.85)',floating:true,verticalAlign:'top',y:25},mapNavigation:{enabled:false},colorAxis:{min:1,type:'logarithmic',minColor:'#EEEEFF',maxColor:'#6C7A89',stops:[[0,'#EFEFFF'],[0.67,'#6C7A89'],[1,'#6C7A89']]},plotOptions:{series:{cursor:'pointer',point:{events:{click:function(){var dim1=this.code;var arr=[];arr.push(dim1);app.field("state_abbr").selectValues(arr,true,true);}}}}},series:[{animation:{duration:1000},data:sample,mapData:Highcharts.maps['countries/us/us-all'],joinBy:['postal-code','code'],dataLabels:{enabled:true,color:'white',format:'{point.code}'},name:"State",states:{hover:{color:'rgba(144, 198, 149,0.85)'}},tooltip:{pointFormat:'Number of customer: {point.value}'}}]});});});$(document).ready(function(){$('.navbar-nav').on('click','a',function(){$('.tab:visible').fadeOut();$('.tab[id='+$(this).attr('data-id')+']').fadeIn();});$("#fieldList").click(function(e){e.stopPropagation();});$("#fieldListC").click(function(e){e.stopPropagation();});$("#clearAll").click(function clearSelection(){app.clearAll();$('.dropdown-toggle').empty();$('#m').append("All Months <span class='caret'><span>");$('#c').append("All Regions <span class='caret'><span>");});});});